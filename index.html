<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ä¸è¶•å¿«å»è®€æ›¸æ˜¯åœ¨çœ‹ä¸‰å°</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700&display=swap" rel="stylesheet">
  <style>
    /* èƒŒæ™¯æ”¹æˆç©º */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
      color: #ddd;
      overflow: hidden;
      position: relative;
    }
    /* å½±ç‰‡å…¨è¢å¹•èƒŒæ™¯æ¨£å¼ */
    #bgVideo {
      position: fixed;
      top: 50%;
      left: 50%;
      min-width: 100vw;
      min-height: 100vh;
      width: 80vw;
      height: 80vh;
      z-index: -1;
      transform: translate(-50%, -50%);
      object-fit: cover;
      cursor: pointer;
    }
    /* ç§»é™¤åŸæœ¬åœ“å½¢æŒ‰éˆ•çš„ CSS */
    #bgButtons {
      display: none !important;
    }
    /* ä»¥ä¸‹ç‚ºåŸæ¨£å¼ï¼Œä¸è®Š */
    .menu-icon {
      font-size: 28px;
      cursor: pointer;
      padding: 12px 20px;
      position: fixed;
      top: 20px;
      left: 20px;
      color: gray !important;
      background-color: white !important;
      z-index: 10000;
      user-select: none;
      transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: none !important;
      border-radius: 20px;
    }
    .menu-icon:hover,
    .menu-icon:active {
      background-color: black !important;
      transform: scale(1.05);
      box-shadow: none !important;
    }
    .menu-icon:hover span,
    .menu-icon:hover span::before,
    .menu-icon:hover span::after {
      background-color: gray !important;
    }
    .menu-icon span,
    .menu-icon span::before,
    .menu-icon span::after {
      display: block;
      background-color: gray !important;
      height: 3px;
      width: 24px;
      border-radius: 2px;
      position: relative;
      transition: all 0.3s ease-in-out;
    }
    .menu-icon span::before,
    .menu-icon span::after {
      content: "";
      position: absolute;
      left: 0;
      background-color: gray !important;
    }
    .menu-icon span::before {
      top: -8px;
    }
    .menu-icon span::after {
      top: 8px;
    }
    .menu-icon.active span {
      background-color: transparent !important;
    }
    .menu-icon.active span::before {
      transform: rotate(45deg);
      top: 0;
    }
    .menu-icon.active:hover span::before,
    .menu-icon.active:hover span::after {
      background-color: white !important;
    }
    .menu-icon.active span::after {
      transform: rotate(-45deg);
      top: 0;
    }
    .top-nav {
      position: fixed;
      top: 0;
      width: 100%;
      background-color: transparent !important;
      box-shadow: none !important;
      z-index: 1200;
      display: grid;
      grid-template-columns: repeat(6, 1fr) auto; /* æ”¹æˆå…­ç­‰åˆ†åŠ auto */
      align-items: center;
      padding: 8px 200px 8px 200px;
      box-sizing: border-box;
      gap: 24px;
      color: #ddd;
    }

    .top-nav .page-banner {
      padding: 0;
      margin: 0;
      height: 36px;
      display: flex;
      align-items: center;
    }
    .top-nav .page-banner img {
      background-color: transparent !important;
      height: 36px;
      width: auto;
      display: block;
      border-radius: 8px;
      box-shadow: none !important;
      user-select: none;
    }
    .top-nav form {
      margin-left: 0;
      display: flex;
      align-items: center;
      height: 36px;
      flex-shrink: 0;
    }

    
    /* èª¿æ•´ä¸Šæ’å…­å€‹æŒ‰éˆ• a æ¨£å¼ */
    .top-nav > .nav-item a {
      background-color: transparent !important;
      box-shadow: none !important;
      color: gray !important;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 20px;
      transition: all 0.3s ease;
      font-weight: bold;
      height: 36px;
      line-height: 20px;
      display: flex;
      align-items: center;
      font-size: 0.9rem;
      white-space: nowrap;
      justify-content: center;
      position: relative;
      user-select: none;
      cursor: pointer;
    }
    /* æ»‘é¼ æ‡¸åœè®Šé»‘åº•ç™½å­— */
    .top-nav > .nav-item a:hover {
      background-color: black !important;
      color: white !important;
      text-shadow: none !important;
      transform: translateY(-3px);
      box-shadow: none !important;
    }
    .top-nav > .nav-item {
      display: flex;
      justify-content: center;
      position: relative;
    }
    .top-nav > .logo-search {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      margin-left: auto;
      padding_right: 0;
      width: auto;
    }
    
    /* å°æœå°‹è¼¸å…¥æ¡†æ–°å¢èªéŸ³è¼¸å…¥æŒ‰éˆ•çš„å°ºå¯¸å¾®èª¿ */
    .top-nav input[type="text"] {
      background-color: transparent !important;
      padding: 6px 10px;
      font-size: 1rem;
      border-radius: 4px 0 0 4px;
      border: none!important;
      outline: none;
      height: 28px;
      color: black !important;
      width: 160px;
      box-sizing: border-box;
      text-shadow: none;
    }
    .top-nav input[type="text"]::-webkit-input-placeholder {
      color: #ccc;
    }
    /* ä¿®æ”¹æœå°‹æŒ‰éˆ• */
    .top-nav button {
      padding: 6px 14px;
      font-size: 1rem;
      border: none!important;
      border-radius: 0 4px 4px 0;
      background-color: transparent !important;
      color: white !important;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
      height: 28px;
      box-sizing: border-box;
      border-top: none;
      border-bottom: none;
      border-left: 1px solid #555;
      display: flex;
      align-items: flex-start;
      padding-top: 2px;
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.6);
    }
    .top-nav button:hover {
      background-color: black !important;
      color: white !important;
    }
    .dropdown-selects {
      position: absolute;
      top: 44px;
      left: 0;
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 12px 16px;
      display: none;
      z-index: 1300;
      color: black;
      min-width: 280px;
      user-select: none;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .dropdown-selects:hover {
      background-color: black;
      color: white;
    }
    .dropdown-selects select {
      width: 80px;
      margin-right: 8px;
      padding: 6px 8px;
      font-size: 1rem;
      border-radius: 20px;
      border: 1px solid #ccc;
      background-color: white;
      color: black;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
      user-select: none;
    }
    .dropdown-selects select:hover:not(:disabled),
    .dropdown-selects select:focus:not(:disabled) {
      background-color: black;
      color: white;
      outline: none;
    }
    .dropdown-selects select:disabled {
      background-color: #eee;
      color: #aaa;
      cursor: not-allowed;
    }
    .dropdown-selects select option {
      border-radius: 20px;
      padding: 6px;
    }
    
    .sidebar {
    width: 190px;
    height: 100vh;
    background-color: #faf3e0;
    padding: 50px 10px 10px 10px; /* ä¸Š50pxï¼Œå·¦å³10px */
    overflow-y: auto;
    position: fixed;   /* ä¿æŒå›ºå®šå®šä½ */
    top: 0;
    left: -300px;      /* åˆå§‹éš±è—åœ¨ç•«é¢å·¦é‚Š */
    transition: left 0.3s ease;
    border-radius: 20px;
    z-index: 9999;
}
    .sidebar.active {
      left: 0;
    }
    .sidebar a {
      padding: 12px 20px;
      text-decoration: none;
      font-size: 1rem;
      color: black;
      display: block;
      transition: 0.3s;
      position: relative;
      overflow: hidden;
      border-radius: 20px;
    }
    .sidebar a::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0%;
      height: 100%;
      background-color: black;
      z-index: -1;
      transition: width 0.3s ease;
      color: white;
    }
    .sidebar a:hover{
      color: #f5f5f5!important;
    }
    .sidebar a:hover::after {
      width: 100%;
    }
    .experience-wrapper {
      display: none !important;
    }
    /* æ–°å¢æ³¢å½¢ç¹ªè£½æŒ‰éˆ•æ¨£å¼ */
    #waveBtn {
      grid-column: 6; /* æ”¾ç¬¬6æ ¼ */
      background: transparent !important;
      border: 1px solid gray;
      border-radius: 20px;
      color: gray;
      font-weight: bold;
      padding: 8px 16px;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
      height: 36px;
      align-self: center;
      justify-self: center;
    }
    #waveBtn:hover {
      background-color: black !important;
      color: white !important;
    }
    /* æ–°å¢ç™»å…¥èˆ‡è¨»å†ŠæŒ‰éˆ•æ¨£å¼ */
    #authButtons {
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: center;
      margin-left: 16px;
      text-decoration: none; /* å»é™¤åº•ç·š */
    }
    
    #authButtons a {
  text-decoration: none; /* å»é™¤ a é è¨­åº•ç·š */
}
    #authButtons button {
      display: flex;               /* ä½¿ç”¨ flex æ’åˆ— */
      justify-content: center;     /* æ–‡å­—æ°´å¹³ç½®ä¸­ */
      align-items: center;         /* æ–‡å­—å‚ç›´ç½®ä¸­ */
      white-space: nowrap;         /* é˜²æ­¢æ›è¡Œ */
      width: auto;                 /* æˆ–å›ºå®šå¯¬åº¦ï¼Œçœ‹ä½ éœ€æ±‚ */
      background-color: transparent;
      border: 1px solid gray;
      color: gray;
      border-radius: 20px;
      padding: 6px 16px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease, color 0.3s ease;
      height: 36px;
      text-decoration: none; /* å»é™¤åº•ç·š */
    }
    #authButtons button:hover {
      background-color: black;
      color: white;
    }
    /* ç™»å…¥/è¨»å†Šè¡¨å–®æ¨¡æ…‹è¦–çª— */
    #login-form, #register-form {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(30, 30, 30, 0.95);
      color: #ddd;
      padding: 24px 36px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      z-index: 1500;
      width: 320px;
      box-sizing: border-box;
    }
    #login-form input, #register-form input {
      width: 100%;
      margin: 8px 0 16px 0;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #555;
      background: #111;
      color: #ddd;
      font-size: 1rem;
      box-sizing: border-box;
    }
    #login-form button, #register-form button {
      width: 100%;
      margin-bottom: 8px;
    }
    #authSwitchButton {
      background: none;
      border: none;
      color: #89c9ff;
      text-decoration: underline;
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0;
      margin-top: 8px;
      width: auto;
    }
    #accountManagement {
  display: none;
  color: white;
  background: #222;
  padding: 10px;
  border-radius: 8px;
  position: absolute;
  top: 100%;     /* èª¿æ•´è®“å€å¡Šè·‘åˆ°ä½¿ç”¨è€…åç¨±ä¸‹æ–¹ */
  left: 0;
  z-index: 1001; /* ç¢ºä¿å±¤ç´šæ¯”ä½¿ç”¨è€…åç¨±é«˜ */
  white-space: nowrap; /* å¦‚æœå…§å®¹ä¸è¦æ›è¡Œ */
  box-shadow: 0 4px 12px rgba(0,0,0,0.5); /* å¯åŠ é™°å½±æå‡è¦–è¦ºåˆ†é›¢ */
}
    #userNameDisplay {
    cursor: pointer;
    position: relative;
    display: inline-block;
    z-index: 1000;
}
   
.dropdown {
    position: relative;    /* åƒè€ƒçˆ¶å…ƒç´ å®šä½ */
}
.dropbtn {
    display: block;
    padding: 8px;
    border-radius: 12px;
    text-decoration: none;
    color: #000;
}
.dropdown-content {
    display: none;
    position: absolute;      /* ç›¸å°çˆ¶å…ƒç´ å®šä½ */
    top: 100%;               /* ç·Šè²¼çˆ¶æŒ‰éˆ•ä¸‹æ–¹ */
    left: 0;                 /* èˆ‡çˆ¶æŒ‰éˆ•å·¦å°é½Š */
    min-width: 200px;
    background-color: #fff;
    border-radius: 12px 12px 12px 12px; /* ä¸‹æ–¹åœ“è§’ */
    box-shadow:none;
    z-index: 1000;
    flex-direction: column;
    overflow: hidden;
    padding: 5px 0;
}
.dropdown-content a {
    display: block;
    padding: 10px 15px;
    text-decoration: none;
    color: #000;
}
.dropdown-content a:hover {
    background-color: #555;  /* æ·±ç°åº• */
    color: #000;             /* é»‘å­— */
}
/* æ‡¸åœé¡¯ç¤º */
.dropdown:hover .dropdown-content,
.dropdown-content:hover {
    display: flex;
}
  </style>
</head>
<body>
  <!-- å°‡åŸ #bgButtons æ•´çµ„åˆªé™¤ï¼Œä¿ç•™ç©ºçš„ bgContainer -->

  <div id="bgContainer"></div>

  <!-- æ–°å¢å…¨è¢å¹•å½±ç‰‡ï¼Œé»æ“Šè·³è½‰ t_course.html -->
  <video id="bgVideo" autoplay muted loop playsinline>
    <source src="/static/video/vg1.mp4" type="video/mp4" />
    æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾ã€‚
  </video>

  <script>
    // é»æ“Šå½±ç‰‡è·³è½‰
    document.getElementById('bgVideo').addEventListener('click', function() {
      window.location.href = '/t_course';
    });
  </script>

  <!-- åŸæœ¬å…§å®¹ç…§è²¼ï¼Œä¸å‹• -->
  <div class="menu-icon" id="menuIcon"><span></span></div>
  <div class="top-nav">
    <div class="page-banner"><a href="https://aud-slp.mmc.edu.tw/">
    <img src="/static/image/logo.png" alt="é¦¬å•è½èªç³»æ©«å¹…åœ–" />
  </a></div>

    <div class="nav-item"><a href="/general_knowledge" id="generalKnowledgeBtn">é€šè­˜</a></div>
    <div class="nav-item"><a href="#" onclick="location.href='/admin/comments'">å•é¡Œå›è¦†å€</a></div>
    <div class="nav-item"><a href="/grade_calculator">æˆç¸¾è¨ˆç®—æ©Ÿ</a></div>
    <div class="nav-item"><a href="/teach">ç¶²ç«™ä½¿ç”¨èªªæ˜</a></div>
    <div class="logo-search">
      
      <form action="/search" method="get" id="searchForm">
        <input 
          type="text" 
          name="q" 
          placeholder="è¼¸å…¥é—œéµå­—æœå°‹..." 
          required 
          id="searchInput" 
          x-webkit-speech 
          lang="zh-TW"
          autocomplete="off"
        />
        <!-- æ–°å¢èªéŸ³è¼¸å…¥æŒ‰éˆ• -->
        <button type="button" id="voiceBtn" title="èªéŸ³è¼¸å…¥" aria-label="èªéŸ³è¼¸å…¥" style="border:none; background:transparent; color:white; font-size:20px; cursor:pointer; padding:0 6px;">
          ğŸ¤
        </button>
        <button type="submit">æœå°‹</button>
      </form>
      <!-- æ–°å¢ç™»å…¥è¨»å†ŠæŒ‰éˆ•å®¹å™¨ -->
      <div id="authButtons">
  {% if username %}
    <span id="userNameDisplay" style="color: gray; font-weight: bold; cursor: pointer;">{{ username }}
    <div id="accountManagement" style="display:none; color: white; background: #222; padding: 10px; border-radius: 8px; position: absolute;">
      <p>å¸³è™Ÿç®¡ç†é é¢</p>
      <a href="{{ url_for('logout') }}" id="logoutLink" style="display: block; width: 100px; margin: 0 auto; text-align: center; text-decoration: none; color:white; ">
    ç™»å‡º
</a>


    </div>
   </span>
  {% else %}
    <a href="{{ url_for('login') }}"><button>ç™»å…¥</button></a>
    <a href="{{ url_for('register') }}"><button>è¨»å†Š</button></a>
  {% endif %}
    </div>   
    </div>
  </div>
  <!-- ç™»å…¥è¡¨å–® -->
  <div id="login-form" tabindex="-1" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <h2 id="loginTitle">ç™»å…¥</h2>
    <input type="text" id="login-username" placeholder="å¸³è™Ÿ" required />
    <input type="password" id="login-password" placeholder="å¯†ç¢¼" required />
    <button id="submit-login">æäº¤ç™»å…¥</button>
    <button id="to-register-from-login" type="button" id="authSwitchButton">å°šæœªè¨»å†Šï¼Ÿé»æ­¤è¨»å†Š</button>
  </div>
  <!-- è¨»å†Šè¡¨å–® -->
  <div id="register-form" tabindex="-1" role="dialog" aria-modal="true" aria-labelledby="registerTitle">
    <h2 id="registerTitle">è¨»å†Š</h2>
    <input type="text" id="reg-name" placeholder="åç¨±" required />
    <input type="text" id="reg-username" placeholder="å¸³è™Ÿ" required />
    <input type="password" id="reg-password" placeholder="å¯†ç¢¼" required />
    <button id="submit-register">æäº¤è¨»å†Š</button>
    <button id="to-login-from-register" type="button" id="authSwitchButton">å·²æœ‰å¸³è™Ÿï¼Ÿé»æ­¤ç™»å…¥</button>
  </div>
  <div id="sidebar" class="sidebar">
    
    <a href="{{ url_for('static', filename='calendar.pdf') }}" target="_blank">æ ¡åœ’è¡Œäº‹æ›†</a>
    <a href="/appointment">é ç´„ç³»çµ±</a>
    <a href="/speech_translate">è‹±æ–‡å³æ™‚å­—å¹•</a>
   
    <!-- æ–°å¢ç´”éŸ³è½åŠ›æª¢æŸ¥æ¨¡æ“¬å™¨æŒ‰éˆ• -->
    <a href="check">ç´”éŸ³è½åŠ›æª¢æŸ¥æ¨¡æ“¬å™¨</a>
    
    <!-- æ–°å¢è·³è½‰åˆ° ear.html æŒ‰éˆ• -->
    
    
    <!-- æ–°å¢åŸºç¤è½åŠ›ç§‘å­¸æŒ‰éˆ• -->
    <div class="dropdown">
        <a href="#" class="dropbtn">åŸºç¤è½åŠ›ç§‘å­¸åœ–å½¢å·¥å…·</a>
        <div class="dropdown-content">
            <a href="/wave">æ³¢å‹ç¹ªè£½</a>
            <a href="/wave4">æ‹éŸ³èˆ‡æŒ¯å¹…èª¿è®Š</a>
            <a href="/wave2">è²å¼·èˆ‡è²å£“è¡°æ¸›</a>
            <a href="/wave3">è€³è¸é›»ä½</a>
            <a href="/two_tone">é›™éŸ³æŠ‘åˆ¶(åŒå‘æŠ‘åˆ¶)&å°å‘æŠ‘åˆ¶</a>
            <a href="/cochlear">rate-level function</a>
        </div>
    </div>
    <!-- è¨€èªç§‘å­¸ -->
  <div class="dropdown">
    <a href="#" class="dropbtn">è¨€èªç§‘å­¸åœ–å½¢å·¥å…·</a>
    <div class="dropdown-content">
      <a href="/vowels">æ¯éŸ³ç‰¹æ€§</a>
    </div>
  </div>
  </div>
  <div class="top-section" id="topSection"></div>
  <div class="bottom-section">
    <div class="select-wrapper" id="noteSection" style="display:none;">
      <select id="gradeSelectBottom" style="display:none; border-radius: 20px;">
        <option value="">è«‹é¸æ“‡å¹´ç´š</option>
        <option value="å¤§ä¸€">å¤§ä¸€</option>
        <option value="å¤§äºŒ">å¤§äºŒ</option>
        <option value="å¤§ä¸‰">å¤§ä¸‰</option>
      </select>
      <select id="semesterSelectBottom" disabled style="display:none; border-radius: 20px;">
        <option value="">è«‹é¸æ“‡å­¸æœŸ</option>
      </select>
      <select id="subjectSelectBottom" disabled style="display:none; border-radius: 20px;">
        <option value="">è«‹é¸æ“‡ç§‘ç›®</option>
      </select>
    </div>
    <div class="experience-wrapper" id="experienceSection">
      <!-- éš±è—ç‹€æ…‹ï¼Œä¸æœƒé¡¯ç¤º -->
      <button onclick="alert('å­¸æ­·é é¢å»ºç½®ä¸­')">å­¸æ­·</button>
      <button onclick="alert('ç¶“æ­·é é¢å»ºç½®ä¸­')">ç¶“æ­·</button>
      <button onclick="alert('å°ˆæ¥­è­‰ç…§é é¢å»ºç½®ä¸­')">å°ˆæ¥­è­‰ç…§</button>
    </div>
  </div>
  <script>
    window.addEventListener('load', () => {
      const sidebar = document.getElementById("sidebar");
      const menuIcon = document.getElementById("menuIcon");
      const notesDropdown = document.getElementById("notesDropdown");
      const gradeSelect = document.getElementById("gradeSelect");
      const semesterSelect = document.getElementById("semesterSelect");
      const subjectSelect = document.getElementById("subjectSelect");
      // åŸ images è¼ªæ’­å·²ç„¡ç”¨ï¼Œä»¥ä¸‹ä»ä¿ç•™ä¸å‹•
      const images = [
        '/static/image/bg1.jpg',
      ];
      const bgContainer = document.createElement('div');
      bgContainer.id = 'bgContainer';
      document.body.prepend(bgContainer);
      const bgDivs = images.map((src, idx) => {
        const div = document.createElement('div');
        div.classList.add('bg-image');
        if (idx === 0) div.classList.add('active');
        div.style.backgroundImage = `url('${src}')`;
        bgContainer.appendChild(div);
        return div;
      });
      let currentIndex = 0;
      setInterval(() => {
        bgDivs[currentIndex].classList.remove('active');
        currentIndex = (currentIndex + 1) % bgDivs.length;
        bgDivs[currentIndex].classList.add('active');
      }, 5000);
      menuIcon.addEventListener("click", () => {
        sidebar.classList.toggle("active");
        menuIcon.classList.toggle("active");
      });
      document.body.addEventListener("click", (event) => {
        if (
          sidebar.classList.contains("active") &&
          (sidebar.contains(event.target) || menuIcon.contains(event.target))
        )
          return;
        if (
          notesDropdown.style.display === "block" &&
          (notesDropdown.contains(event.target))
        )
          return;
        if (sidebar.classList.contains("active")) {
          sidebar.classList.remove("active");
          menuIcon.classList.remove("active");
        }
        if (notesDropdown.style.display === "block") {
          notesDropdown.style.display = "none";
        }
      });
      gradeSelect.addEventListener("change", () => {
        semesterSelect.innerHTML = '<option value="">è«‹é¸æ“‡å­¸æœŸ</option>';
        subjectSelect.innerHTML = '<option value="">è«‹é¸æ“‡ç§‘ç›®</option>';
        const grade = gradeSelect.value;
        if (grade && semesterData[grade]) {
          semesterData[grade].forEach((sem) => {
            const opt = document.createElement("option");
            opt.value = sem;
            opt.textContent = sem;
            semesterSelect.appendChild(opt);
          });
          semesterSelect.disabled = false;
        } else {
          semesterSelect.disabled = true;
        }
        subjectSelect.disabled = true;
      });
      semesterSelect.addEventListener("change", () => {
        subjectSelect.innerHTML = '<option value="">è«‹é¸æ“‡ç§‘ç›®</option>';
        const key = `${gradeSelect.value}-${semesterSelect.value}`;
        if (subjectData[key]) {
          subjectData[key].forEach((subj) => {
            const opt = document.createElement("option");
            opt.value = subj;
            opt.textContent = subj;
            subjectSelect.appendChild(opt);
          });
          subjectSelect.disabled = false;
        } else {
          subjectSelect.disabled = true;
        }
      });
      // æ–°å¢é»æ“Šèª²ç¨‹å¾Œè·³è½‰åˆ°course_detail.html
      subjectSelect.addEventListener("change", () => {
        const subject = subjectSelect.value;
        if (subject) {
          // ä½¿ç”¨ encodeURIComponent é€²è¡Œ URL ç·¨ç¢¼é˜²æ­¢éŒ¯èª¤
          const encodedSubject = encodeURIComponent(subject);
          // å°å‘ /course/<course_name> è·¯ç”±
          window.location.href = `/course/${encodedSubject}`;
        }
      });
      const sidebarNotesBtn = document.getElementById("sidebarNotesBtn");
      sidebarNotesBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (sidebar.classList.contains("active")) {
          sidebar.classList.remove("active");
          menuIcon.classList.remove("active");
        }
      });
      const semesterData = {
        å¤§ä¸€: ["ä¸Šå­¸æœŸ", "ä¸‹å­¸æœŸ"],
        å¤§äºŒ: ["ä¸Šå­¸æœŸ", "ä¸‹å­¸æœŸ"],
        å¤§ä¸‰: ["ä¸Šå­¸æœŸ", "ä¸‹å­¸æœŸ"],
      };
      const subjectData = {
        "å¤§ä¸€-ä¸Šå­¸æœŸ": [
          "æºé€šéšœç¤™å­¸å°è«–",
          "æ™®é€šå¿ƒç†å­¸",
          "èªè¨€å­¸æ¦‚è«–",
          "è½èªç§‘å­¸å°è«–",
          "è§£å‰–å­¸",
        ],
        "å¤§ä¸€-ä¸‹å­¸æœŸ": [
          "åŸºç¤è½åŠ›ç§‘å­¸",
          "è¨€èªç§‘å­¸",
          "ç”Ÿç†å­¸",
          "è½èªç¥ç¶“è§£å‰–æ©Ÿè½‰",
          "åŸºç¤è‡¨åºŠå¯¦å‹™è«–(äºŒ)",
          "å…’ç«¥èªè¨€ç™¼å±•å­¸",
          "èªéŸ³éŸ³éŸ»å­¸",
        ],
        "å¤§äºŒ-ä¸Šå­¸æœŸ": ["æœªçŸ¥", "æœªçŸ¥", "æœªçŸ¥"],
        "å¤§äºŒ-ä¸‹å­¸æœŸ": ["æœªçŸ¥", "æœªçŸ¥", "æœªçŸ¥"],
        "å¤§ä¸‰-ä¸Šå­¸æœŸ": ["æœªçŸ¥", "æœªçŸ¥", "æœªçŸ¥"],
        "å¤§ä¸‰-ä¸‹å­¸æœŸ": ["æœªçŸ¥", "æœªçŸ¥", "æœªçŸ¥"],
      };
      // æ–°å¢èªéŸ³è¾¨è­˜åŠŸèƒ½ï¼Œä¸¦åœ¨è¾¨è­˜çµæŸå¾Œç›´æ¥æäº¤æœå°‹è¡¨å–®
      const voiceBtn = document.getElementById('voiceBtn');
      const searchInput = document.getElementById('searchInput');
      const searchForm = document.getElementById('searchForm');
      let recognition;
      if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
      } else if ('SpeechRecognition' in window) {
        recognition = new SpeechRecognition();
      } else {
        recognition = null;
      }
      if (recognition) {
        recognition.lang = 'zh-TW';
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.onstart = () => {
          voiceBtn.style.color = 'red'; // èªéŸ³è¼¸å…¥ä¸­è®Šç´…è‰²æç¤º
        };
        recognition.onresult = (event) => {
          if(event.results.length > 0) {
            searchInput.value = event.results[0][0].transcript;
          }
        };
        recognition.onerror = (event) => {
          console.error('èªéŸ³è¾¨è­˜éŒ¯èª¤:', event.error);
        };
        recognition.onend = () => {
          voiceBtn.style.color = 'white'; // çµæŸæ¢å¾©ç™½è‰²
          // èªéŸ³è¼¸å…¥å®Œç•¢è‡ªå‹•æäº¤æœå°‹è¡¨å–®
          if (searchInput.value.trim() !== "") {
            searchForm.submit();
          }
        };
        voiceBtn.addEventListener('click', () => {
          if(voiceBtn.style.color === 'red') {
            recognition.stop();
          } else {
            recognition.start();
          }
        });
      } else {
        // è‹¥ä¸æ”¯æŒèªéŸ³APIï¼ŒæŒ‰éˆ•é»æ“Šå–Šæé†’
        voiceBtn.addEventListener('click', () => {
          alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜åŠŸèƒ½');
        });
      }
      // æ–°å¢æ³¢å½¢ç¹ªè£½æŒ‰éˆ•è·³è½‰äº‹ä»¶
      const waveBtn = document.getElementById('waveBtn');
      if (waveBtn) {
        waveBtn.addEventListener('click', () => {
          window.location.href = '/wave';  // è·¯ç”±åç¨±å°æ‡‰ flask è·¯ç”±
        });
      }
      // ç™»å…¥èˆ‡è¨»å†ŠæŒ‰éˆ•åŠè¡¨å–®é‚è¼¯
      const loginBtn = document.getElementById('login-btn');
      const registerBtn = document.getElementById('register-btn');
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const submitLoginBtn = document.getElementById('submit-login');
      const submitRegisterBtn = document.getElementById('submit-register');
      const toRegisterFromLoginBtn = document.getElementById('to-register-from-login');
      const toLoginFromRegisterBtn = document.getElementById('to-login-from-register');
      const authButtonsDiv = document.getElementById('authButtons');
      // é¡¯ç¤ºç™»å…¥è¡¨å–®
      loginBtn.onclick = () => {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
      };
      // é¡¯ç¤ºè¨»å†Šè¡¨å–®
      registerBtn.onclick = () => {
        registerForm.style.display = 'block';
        loginForm.style.display = 'none';
      };
      // ç™»å…¥é é¢åˆ‡æ›åˆ°è¨»å†Šé é¢
      toRegisterFromLoginBtn.onclick = () => {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
      };
      // è¨»å†Šé é¢åˆ‡æ›åˆ°ç™»å…¥é é¢
      toLoginFromRegisterBtn.onclick = () => {
        registerForm.style.display = 'none';
        loginForm.style.display = 'block';
      };
      // è¨»å†Šç”¨æˆ¶ä¸¦å„²å­˜è³‡æ–™
      submitRegisterBtn.onclick = () => {
        const name = document.getElementById('reg-name').value.trim();
        const username = document.getElementById('reg-username').value.trim();
        const password = document.getElementById('reg-password').value.trim();
        if (!name || !username || !password) {
          alert('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
          return;
        }
        let users = JSON.parse(localStorage.getItem('users') || '{}');
        if (users[username]) {
          alert('å¸³è™Ÿå·²å­˜åœ¨');
          return;
        }
        users[username] = { name, password, actions: [] };
        localStorage.setItem('users', JSON.stringify(users));
        alert('è¨»å†ŠæˆåŠŸï¼Œè«‹ç™»å…¥');
        registerForm.style.display = 'none';
        loginForm.style.display = 'block';
      };
      // ç™»å…¥é©—è­‰èˆ‡åˆ‡æ›æŒ‰éˆ•ç‚ºç”¨æˆ¶åç¨±
      submitLoginBtn.onclick = () => {
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value.trim();
        let users = JSON.parse(localStorage.getItem('users') || '{}');
        if (!users[username]) {
          alert('å¸³è™Ÿä¸å­˜åœ¨ï¼Œè«‹å…ˆè¨»å†Š');
          return;
        }
        if (users[username].password !== password) {
          alert('å¯†ç¢¼éŒ¯èª¤');
          return;
        }
        loginForm.style.display = 'none';
        registerForm.style.display = 'none';
        // å°‡ç™»å…¥åŠè¨»å†ŠæŒ‰éˆ•æ”¹ç‚ºç”¨æˆ¶åç¨±é¡¯ç¤º
        authButtonsDiv.innerHTML = `<span style="color: gray; font-weight: bold; cursor: default;">${users[username].name}</span>`;
        // é‚„åŸæ“ä½œ
  const actions = users[username].actions || [];
  restoreUserActions(actions);
};
  // ç›£è½æ“ä½œã€è¨˜éŒ„ä¸¦å­˜åœ¨ localStorage
  function recordUserAction(username, action) {
    let users = JSON.parse(localStorage.getItem('users') || '{}');
    if (!users[username]) users[username] = {name: username, password: '', actions: []};
    users[username].actions = users[username].actions || [];
    users[username].actions.push(action);
    localStorage.setItem('users', JSON.stringify(users));
  }
  // é‚„åŸæ“ä½œçš„ç¤ºç¯„å‡½å¼
  function restoreUserActions(actions) {
    actions.forEach(action => {
      if (action.type === 'selectChange') {
        const element = document.getElementById(action.elementId);
        if (element) {
          element.value = action.value;
          // å¯è§¸ç™¼ change äº‹ä»¶ï¼Œä½¿ä»‹é¢åŒæ­¥æ›´æ–°
          element.dispatchEvent(new Event('change'));
        }
      }
      // å…¶ä»–æ“ä½œé¡å‹ä¾éœ€æ±‚å¢åŠ 
    });
  }
  // ç›£è½å¹´ç´š/å­¸æœŸ/ç§‘ç›®é¸æ“‡æ”¹è®Šï¼Œä¸¦ç´€éŒ„
  window.addEventListener('load', () => {
    const username = document.getElementById('login-username')?.value.trim() || '';
    ['gradeSelect', 'semesterSelect', 'subjectSelect', 'gradeSelectBottom', 'semesterSelectBottom', 'subjectSelectBottom'].forEach(selectId => {
      const selectElem = document.getElementById(selectId);
      if (selectElem) {
        selectElem.addEventListener('change', (e) => {
          if(username){
            recordUserAction(username, {
              type: 'selectChange',
              elementId: selectId,
              value: e.target.value,
              timestamp: new Date().toISOString(),
            });
          }
        });
      }
    });
  });
</script>
<script>
  // æ¼¢å ¡é¸å–®æ§åˆ¶
  const menuIcon = document.getElementById("menuIcon");
  const sidebar = document.getElementById("sidebar");
  menuIcon.addEventListener("click", () => {
    menuIcon.classList.toggle("active");
    sidebar.classList.toggle("active");
  });
  // å¸³è™Ÿåç¨±æ§åˆ¶
  const userNameDisplay = document.getElementById("userNameDisplay");
  const accountManagement = document.getElementById("accountManagement");
  if (userNameDisplay && accountManagement) {
    userNameDisplay.addEventListener("click", (e) => {
      e.stopPropagation(); // é¿å…å†’æ³¡
      accountManagement.style.display =
        accountManagement.style.display === "block" ? "none" : "block";
    });
    // é»æ“Šå¤–éƒ¨å€åŸŸé—œé–‰
    document.addEventListener("click", (e) => {
      if (!userNameDisplay.contains(e.target)) {
        accountManagement.style.display = "none";
      }
    });
  }
document.querySelectorAll('.dropdown').forEach(drop => {
    const btn = drop.querySelector('.dropbtn');
    const menu = drop.querySelector('.dropdown-content');
    btn.addEventListener('click', (e) => {
        e.preventDefault(); // é˜²æ­¢è·³é 
        // åˆ¤æ–·ç›®å‰æ˜¯å¦å·²ç¶“é¡¯ç¤º
        const isVisible = menu.style.display === 'flex';
        // æ”¶èµ·å…¶ä»–å­é¸å–®
        document.querySelectorAll('.dropdown-content').forEach(m => {
            if (m !== menu) m.style.display = 'none';
        });
        // åˆ‡æ›ç•¶å‰å­é¸å–®é¡¯ç¤º/æ”¶èµ·
        menu.style.display = isVisible ? 'none' : 'flex';
    });
});
// é»æ“Šé é¢å…¶ä»–åœ°æ–¹æ”¶èµ·æ‰€æœ‰å­é¸å–®
document.addEventListener('click', (e) => {
    if (!e.target.closest('.dropdown')) {
        document.querySelectorAll('.dropdown-content').forEach(m => m.style.display = 'none');
    }
});
</script>
</body>
</html>
